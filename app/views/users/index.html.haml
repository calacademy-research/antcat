-page_title 'Users'
-breadcrumb :users

-if user_is_superadmin?
  -content_for :breadcrumbs_right do
    =link_to append_superadmin_icon("New"), new_user_path, class: "btn-normal"

-if user_is_at_least_helper?
  %p
    %span.bg-logged-in-only.mb-8
      Emails are only visible to logged in helpers and editors.
      =logged_in_only_tooltip_icon user_group: 'helpers/editors'

-if user_is_superadmin?
  %p
    %span.bg-logged-in-only.mb-8
      Activity and PaperTrail version counts are only visible to superadmins.
      =logged_in_only_tooltip_icon user_group: 'superadmins'

%table.table-striped.table-stack
  %tbody
    -@active_users.each do |user|
      %tr
        %td=user.decorate.user_page_link
        %td
          =user.decorate.user_badge
          -if user.superadmin? && user_is_at_least_helper?
            %span.label-high-priority.rounded-badge superadmin
        -if user_is_superadmin?
          %td=link_to "#{user.activities.count}&nbsp;activities".html_safe, activities_path(user_id: user.id)
          %td=link_to "#{user.created_paper_trail_versions.count}&nbsp;PTVs".html_safe, versions_path(whodunnit: user.id)
        %td
          -if user.author
            =link_to 'Author page', user.author, class: 'btn-normal btn-tiny'
        -if user_is_at_least_helper?
          %td=user.email
          %td Reg. #{user.created_at.year}

-if @hidden_users
  %h5.mt-20
    Hidden users
    =logged_in_only_tooltip_icon user_group: 'helpers/editors'
  %table.table-striped.table-stack
    %tbody
      -@hidden_users.each do |user|
        %tr{class: ('bg-pale-alert' if (user.locked? || user.deleted?))}
          %td=user.decorate.user_page_link
          %td=user.decorate.user_badge
          -if user_is_superadmin?
            %td=link_to "#{user.activities.count}&nbsp;activities".html_safe, activities_path(user_id: user.id)
            %td=link_to "#{user.created_paper_trail_versions.count}&nbsp;PTVs".html_safe, versions_path(whodunnit: user.id)
          %td
            -if user.locked?
              %span.label-warning.rounded-badge locked
            -if user.deleted?
              %span.label-warning.rounded-badge soft-deleted
            -if user.hidden?
              %span.label-warning.rounded-badge hidden
          %td=user.email
          %td Reg. #{user.created_at.year}

-if @deleted_or_locked_users
  %h5.mt-20
    Deleted or locked users
    %small This section is only visible to superadmins.
    =logged_in_only_tooltip_icon user_group: 'superadmins'
  %table.table-unstriped.table-stack
    %tbody
      -@deleted_or_locked_users.each do |user|
        %tr{class: ('bg-pale-alert' if (user.locked? || user.deleted?))}
          %td=user.decorate.user_page_link
          %td=user.decorate.user_badge
          -if user_is_superadmin?
            %td=link_to "#{user.activities.count}&nbsp;activities".html_safe, activities_path(user_id: user.id)
            %td=link_to "#{user.created_paper_trail_versions.count}&nbsp;PTVs".html_safe, versions_path(whodunnit: user.id)
          %td
            -if user.locked?
              %span.label-warning.rounded-badge locked
            -if user.deleted?
              %span.label-warning.rounded-badge soft-deleted
            -if user.hidden?
              %span.label-warning.rounded-badge hidden
          %td=user.email
          %td Reg. #{user.created_at.year}
