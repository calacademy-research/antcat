-#Locals: references, reference

- references ||= nil
- reference ||= nil

.antcat_reference_popup.ui-widget.ui-widget-content.ui-corner-all
  .template
    = render 'reference_popups/panel', reference: Reference.new

  %table.references.current
    %tr
      %td
        = render 'reference_popups/panel', reference: reference

  .expansion.nested_form

    = hidden_field_tag 'id', reference.try(:id)

    %table
      %tr
        %td.throbber= image_tag 'ui-anim_basic_16x16.gif'
        %td.controls
          = button_tag 'OK', class: 'ok ui-priority-primary'
          = button_tag 'Cancel', class: 'close ui-priority-secondary'
          = button_tag 'Add', class: 'add ui-priority-primary'
          = select_tag "search_selector", options_for_select(["Search for author(s)", "Search for"], params[:search_selector]), class: 'search_controls search_selector'
          = text_field_tag "q", params[:q], class: 'search_controls q'
          = button_tag 'Go', class: 'search_controls go ui-priority-primary'
          = button_tag 'Cancel', class: 'search_controls close ui-priority-secondary'

          = will_paginate references if references

          .help_banner
            %span.help_banner_text

    - if references && (references.first != reference || references.size != 1 || params[:q].present?)

      -if references.empty?
        .no_results_found No results found

      %table.references.search_results
        - for reference in references
          %tr
            %td= render 'reference_popups/panel', reference: reference

    = render 'shared/qtip'
