- @title = 'Forager'

- content_for :head do
  = javascript_include_tag 'forager', 'taxon_key'
  = javascript_include_tag 'ext/jquery.scrollTo-1.4.2-min'
  = stylesheet_link_tag 'forager'

  :javascript
    var selectedBrowserTaxonID = #{@selected_browser_taxon.try(:id) || 0};

- content_for :page_header do
  #navigation_bar
    = form_tag forager_path, :method => 'get', :id => 'search_form' do
      .actions
        = link_to 'Taxatry', taxatry_path(@taxon)
        |
        = link_to 'References', references_path
      .search
        Search for name
        = select_tag :search_type, options_for_select(['matching', 'beginning with', 'containing'], params[:search_type] || 'beginning with')
        = hidden_field_tag "id", params[:id]
        = text_field_tag "q", params[:q]
        = submit_tag  "Go"
        - if @search_results.present? && @search_results.size > 1
          = submit_tag "Clear"
        = @search_results_message
  = render 'shared/catalog_title'

#index
  - if @taxon
    - @index_header_taxa.each do |index_header_taxon|
      .index_header_taxon
        - label_and_classes = taxon_label_and_css_classes index_header_taxon[:taxon], true
        = link_to label_and_classes[:label], index_header_taxon[:path], :class => label_and_classes[:css_classes]

  - index_items = make_index_groups @taxa, 50, 10
  - index_items.each do |item|
    .index_taxon
      = link_to item[:label], forager_path(item[:id]), :class => item[:css_classes]

#browser
  - if @taxon
    .header
      .taxonomic_history= raw @taxon.taxonomic_history
    %hr

  .contents
    - @taxa.each do |taxon|
      .taxon_header{:id => taxon.id}
        - unless @taxon && @taxon.rank == 'genus'
          - label_and_classes = taxon_label_and_css_classes taxon
          = link_to label_and_classes[:label], forager_path(taxon), :class => label_and_classes[:css_classes]
      %div{:class => "taxonomic_history #{taxon.rank}"}
        = raw taxon.taxonomic_history
    - 100.times do
      .taxon_header
        &nbsp;

.clear

= render 'shared/taxon_key'
