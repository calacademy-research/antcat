-#Locals: references, reference, picker_type

- picker_type = 'field'
- references ||= nil
- reference ||= nil
- css_class = "antcat_reference_#{picker_type}"

.antcat_reference_picker.antcat_panel{class: css_class}
  .template
    = render 'reference_fields/panel', reference: Reference.new

  - if picker_type == 'field'
    .display
      %button.display_button= reference && reference.id ? format_reference(reference) : '(none)'
    .edit

      %table.references.current
        %tr
          %td
            = render 'reference_fields/panel', reference: reference

      .expansion.nested_form

        %table
          %tr
            %td.throbber= image_tag 'ui-anim_basic_16x16.gif'
            %td.controls
              = render "reference_#{picker_type}s/controls", reference: reference
              = will_paginate references if references
              .help_banner
                %span.help_banner_text

        - if references && (references.first != reference || references.size != 1 || params[:q].present?)
          -if references.empty?
            .no_results_found No results found
          %table.references.search_results
            - for reference in references
              %tr
                %td= render 'reference_fields/panel', reference: reference

        = render 'shared/qtip'
