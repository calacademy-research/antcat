- @title = @taxon.name.epithet

=enable_tooltips

- content_for :head do
  = javascript_include_tag  'ext/jquery.spinner.js'
  = javascript_include_tag  'widgets/panel'
  = javascript_include_tag  'widgets/form', 'widgets/ajax_form', 'widgets/nested_form'
  = javascript_include_tag  'widgets/reference_picker', 'widgets/reference_panel', 'widgets/reference_form'
  = javascript_include_tag  'widgets/reference_field'
  = javascript_include_tag  'widgets/name_field'
  = javascript_include_tag  'widgets/reference_popup', 'widgets/name_popup', 'widgets/taxt_editor'
  = javascript_include_tag  'taxa', 'parent_section', 'current_valid_taxon_section', 'history_items_section', 'synonyms_section', 'references_section', 'homonym_replaced_by_section'

- content_for :page_header do
  #navigation_bar
    .clear
    .title.left= @title

- content_for :page_contents do
  - url = @taxon.new_record? ?  '/taxa': "/taxa/#{@taxon.id}"
  - method = @taxon.new_record? ? 'post' : 'put'
  = form_for @taxon, as: :taxon, url: url, method: method, html: {class: 'taxon_form ui-widget'} do |form|

    -#These fields are used to pass pre-caulculated data to javascript
    -# and they're magically appended to the POST.
    = hidden_field_tag 'current_taxon_id', @id
    = hidden_field_tag 'rank_to_create', @rank_to_create
    = hidden_field_tag 'parent_id', @parent_id
    = hidden_field_tag 'add_taxon_path', @add_taxon_path
    = hidden_field_tag 'add_tribe_path', @add_tribe_path
    = hidden_field_tag 'cancel_path', @cancel_path
    = hidden_field_tag 'convert_to_subspecies_path', @convert_to_subspecies_path
    = hidden_field_tag 'taxon_rank', @taxon.rank
    = hidden_field_tag 'species_id', @taxon.rank.to_s == "subspecies" ?  @taxon.species_id : true
    = hidden_field_tag 'taxon_name_string', @taxon.name_cache
    = hidden_field_tag 'collision_resolution', @collision_resolution
    = hidden_field_tag 'reset_epithet', @reset_epithet
    = hidden_field_tag 'previous_combination_id', @previous_combination ? @previous_combination.id : nil
    = hidden_field_tag 'is_superadmin', @user.try(:is_superadmin?)

    = render 'shared/errors_for', resource: @taxon

    .fields_section.section.ui-widget-content.ui-corner-all
      = render 'name_status_flags_section',         taxon: @taxon, form: form, default_name_string: @default_name_string
      = render 'protonym_section',                  taxon: @taxon, form: form
      = render 'type_section',                      taxon: @taxon, form: form

      -#Passed to the buttons widget (javascript) to control how the buttons look and behave. Populated
      -#by the taxa_controller.
      = render 'buttons_section',                   form: form,                                                              |
                                                      possible_homonym:                  @possible_homonym,                  |
                                                      show_elevate_to_species_button:    @show_elevate_to_species_button,    |
                                                      show_convert_to_subspecies_button: @show_convert_to_subspecies_button, |
                                                      add_taxon_button_text:             @add_taxon_button_text,             |
                                                      add_tribe_button_text:             @add_tribe_button_text,             |
                                                      show_delete_taxon_button:          @show_delete_taxon_button           |

    - unless @taxon.new_record?
      = render 'history_items_section',               taxon: @taxon
      = render 'children_section',                    taxon: @taxon
      = render 'junior_and_senior_synonyms_section',  taxon: @taxon
      = render 'references_section',                  taxon: @taxon

  %div{:class => "ui-icon ui-icon-alert duplicate-modal", :id => "duplicate_message"}
