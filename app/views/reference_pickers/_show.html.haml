-#Locals: references, reference

- references ||= nil
- reference ||= nil

.antcat_reference_picker.ui-widget.ui-widget-content.ui-corner-all
  .template
    = render 'reference_pickers/panel', reference: Reference.new

  %table.references.current
    %tr
      %td
        = render 'reference_pickers/panel', reference: reference

  .expansion.nested_form

    = hidden_field_tag 'value', reference.try(:id), class: 'value'

    %table
      %tr
        %td.expand_collapse_icon
          = image_tag 'expanded.png', alt: ''
        %td.throbber= image_tag 'ui-anim_basic_16x16.gif'
        %td.controls
          .ok_cancel_controls
            = button_tag 'OK', class: 'ok ui-priority-primary'
            = button_tag 'Cancel', class: 'close ui-priority-secondary'

          .add_controls
            = button_tag 'Add', class: 'add ui-priority-primary'

          .search_controls
            = select_tag "search_selector", options_for_select(["Search for author(s)", "Search for"], params[:search_selector]), class: 'search_selector'
            = text_field_tag "q", params[:q], class: 'q'
            = button_tag 'Go', class: 'go ui-priority-primary'
            = button_tag 'Cancel', class: 'close ui-priority-secondary'

          = will_paginate references if references

          .help_banner
            %span.help_banner_text

    - if references && (references.first != reference || references.size != 1 || params[:q].present?)

      -if references.empty?
        .no_results_found No results found

      %table.references.search_results
        - for reference in references
          %tr
            %td= render 'reference_pickers/panel', reference: reference

    = render 'shared/qtip'
